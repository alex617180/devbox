#!/usr/bin/env bash
set -euo pipefail
source "$(dirname "$0")/_lib.sh"; load_env
major="${1:-}"; [[ -z "$major" ]] && { echo "usage: use-node <18|20|22>"; exit 1; }
envf="$DEVBOX_DIR/.env"; touch "$envf"
grep -q "^NODE_MAJOR=" "$envf" && sed -i.bak "s/^NODE_MAJOR=.*/NODE_MAJOR=$major/" "$envf" || echo "NODE_MAJOR=$major" >> "$envf"

# –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º —Ç–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π workspace (–º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å DEVBOX_PHP=74 ...)
echo "üîÑ Rebuild ${WS_SERVICE} with Node $major‚Ä¶"
docker compose -f "$DEVBOX_DIR/docker-compose.yml" build "${WS_SERVICE}"
docker compose -f "$DEVBOX_DIR/docker-compose.yml" up -d "${WS_SERVICE}"
docker compose -f "$DEVBOX_DIR/docker-compose.yml" exec "${WS_SERVICE}" node -v
